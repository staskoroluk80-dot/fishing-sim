<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2D –†–∏–±–∞–ª–∫–∞: –í–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden; 
            background-color: #333;
            font-family: 'Montserrat', sans-serif;
            touch-action: none; 
            user-select: none;
        }

        canvas {
            display: block;
        }

        /* –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        #ui-layer {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 2px 2px 4px black;
            pointer-events: none;
            z-index: 10;
        }

        /* –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–æ —Ü–µ–Ω—Ç—Ä—É */
        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #FFD700;
            font-size: 26px;
            font-weight: bold;
            text-shadow: 2px 2px 4px black;
            text-align: center;
            display: none;
            pointer-events: none;
            z-index: 20;
        }

        /* –ö–µ—Ä—É–≤–∞–Ω–Ω—è */
        #mobile-controls {
            position: absolute;
            bottom: 30px;
            width: 100%;
            height: 120px;
            display: flex;
            justify-content: space-between;
            padding: 0 40px;
            box-sizing: border-box;
            pointer-events: none; /* –ü—Ä–æ–ø—É—Å–∫–∞—î –∫–ª—ñ–∫–∏ –∫—Ä—ñ–∑—å –ø—É—Å—Ç—ñ –º—ñ—Å—Ü—è */
            z-index: 15;
        }

        .joystick-area {
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            position: relative;
            pointer-events: auto; 
        }

        .joystick-stick {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .action-btn {
            width: 100px;
            height: 100px;
            background: rgba(255, 69, 0, 0.6);
            border-radius: 50%;
            border: 3px solid white;
            color: white;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: auto; 
            font-family: 'Montserrat', sans-serif;
        }

        .action-btn:active {
            background: rgba(255, 69, 0, 0.9);
            transform: scale(0.95);
        }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div>üêü –†–∏–±–∞: <span id="fish-count">0</span></div>
        <div>üí∞ –ì—Ä–æ—à—ñ: <span id="money-count">0</span></div>
        <div style="margin-top: 5px;">‚è∞ –ß–∞—Å: <span id="time-display">06:00</span></div>
    </div>

    <div id="message"></div>

    <div id="mobile-controls">
        <div class="joystick-area" id="joystick">
            <div class="joystick-stick" id="stick"></div>
        </div>
        <div class="action-btn" id="action-btn">–î–Ü–Ø</div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // --- –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø –ì–†–ò ---
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let currentScene = 'shore'; // 'shore', 'shop', 'home'

    // –ß–∞—Å
    const time = {
        gameHour: 6,
        gameMinute: 0,
        timeScale: 0.05, // –ó–ù–ê–ß–ù–û –ü–û–í–Ü–õ–¨–ù–Ü–®–ï (–±—É–ª–æ 0.1)
        lastTime: 0
    };

    // –ì—Ä–∞–≤–µ—Ü—å
    const player = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        size: 60,
        speed: 5,
        fish: 0,
        money: 0,
        isFishing: false,
        rodLevel: 1
    };

    // –ê–ø–≥—Ä–µ–π–¥–∏
    const upgrades = {
        rod: { level: 2, cost: 50, timeReduction: 1500, description: "–°–ø—ñ–Ω—ñ–Ω–≥ PRO" }
    };

    // --- –ó–û–ù–ò (–û–≥–æ–ª–æ—à—É—î–º–æ –∑–º—ñ–Ω–Ω—ñ, —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –≤ updateZoneDimensions) ---
    let waterZone = {};
    let shopEntrance = {};
    let homeEntrance = {};

    let shopInterior = {};
    let shopCrates = {};
    let shopUpgrade = {};

    let homeInterior = {};
    let homeBed = {};

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø—Ä–∞–π—Ç–∞
    const playerImage = new Image();
    playerImage.src = 'Buzz_fisherman.png';
    let isImageLoaded = false;

    playerImage.onload = () => { isImageLoaded = true; startGame(); };
    playerImage.onerror = () => { console.log("–°–ø—Ä–∞–π—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫—Ä—É–≥."); startGame(); };

    // --- –§–£–ù–ö–¶–Ü–Ø –†–û–ó–†–ê–•–£–ù–ö–£ –ó–û–ù (–©–æ–± –Ω–µ –∑–ª–∏–ø–∞–ª–∏—Å—è) ---
    function updateZoneDimensions() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // 1. –ë–ï–†–ï–ì (Shore)
        const sideWidth = canvas.width * 0.15; // 15% –∑ –±–æ–∫—ñ–≤
        
        waterZone = { x: 0, y: 0, w: sideWidth, h: canvas.height, color: '#29B6F6' };
        
        shopEntrance = { x: canvas.width - sideWidth, y: 0, w: sideWidth, h: canvas.height, color: '#5D4037' };
        
        // –î—ñ–º —Å—Ç—Ä–æ–≥–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É
        const homeW = 180;
        const homeH = 150;
        homeEntrance = { 
            x: (canvas.width / 2) - (homeW / 2), 
            y: 50, // –í—ñ–¥—Å—Ç—É–ø –∑–≤–µ—Ä—Ö—É
            w: homeW, 
            h: homeH, 
            color: '#8D6E63' 
        };

        // 2. –Ü–ù–¢–ï–†'–Ñ–† –ú–ê–ì–ê–ó–ò–ù–£ (Shop)
        shopInterior = { color: '#3E2723', exitY: canvas.height - 80 };
        shopCrates = { x: canvas.width * 0.3, y: canvas.height * 0.4, size: 80, color: '#FFB74D' }; // –ó–ª—ñ–≤–∞
        shopUpgrade = { x: canvas.width * 0.7, y: canvas.height * 0.4, size: 80, color: '#00BCD4' }; // –°–ø—Ä–∞–≤–∞

        // 3. –Ü–ù–¢–ï–†'–Ñ–† –î–û–ú–£ (Home)
        homeInterior = { color: '#5D4037', exitY: canvas.height - 80 };
        homeBed = { x: canvas.width / 2 - 60, y: 100, w: 120, h: 80, color: '#EF5350' }; // –õ—ñ–∂–∫–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É –∑–≤–µ—Ä—Ö—É
    }

    // --- –°–ò–°–¢–ï–ú–ê –ß–ê–°–£ ---
    function updateTime(dt) {
        // dt - —Ü–µ —Å–µ–∫—É–Ω–¥–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É
        // 60 - —Ü–µ –º–Ω–æ–∂–Ω–∏–∫ –¥–ª—è —Ö–≤–∏–ª–∏–Ω
        time.gameMinute += dt * 60 * time.timeScale;

        if (time.gameMinute >= 60) {
            time.gameMinute = 0;
            time.gameHour++;
        }
        if (time.gameHour >= 24) {
            time.gameHour = 0;
        }

        const h = String(time.gameHour).padStart(2, '0');
        const m = String(Math.floor(time.gameMinute)).padStart(2, '0');
        document.getElementById('time-display').innerText = `${h}:${m}`;
    }

    function getDayNightColor() {
        const h = time.gameHour + time.gameMinute/60;
        let alpha = 0;

        // –ù—ñ—á: 22:00 - 05:00 (–¢–µ–º–Ω–æ 0.7)
        // –†–∞–Ω–æ–∫: 05:00 - 08:00 (–°–≤—ñ—Ç–ª—ñ—à–∞—î)
        // –î–µ–Ω—å: 08:00 - 19:00 (0.0)
        // –í–µ—á—ñ—Ä: 19:00 - 22:00 (–¢–µ–º–Ω—ñ—î)

        if (h >= 22 || h < 5) alpha = 0.75;
        else if (h >= 5 && h < 8) alpha = 0.75 - ((h - 5) / 3) * 0.75;
        else if (h >= 8 && h < 19) alpha = 0;
        else if (h >= 19 && h < 22) alpha = ((h - 19) / 3) * 0.75;

        return `rgba(0, 0, 9, ${alpha.toFixed(2)})`; // –°–∏–Ω—ñ–π –≤—ñ–¥—Ç—ñ–Ω–æ–∫ –Ω–æ—á—ñ
    }

    // --- –ö–ï–†–£–í–ê–ù–ù–Ø ---
    const keys = { w: false, a: false, s: false, d: false };
    const joyInput = { x: 0, y: 0 };

    window.addEventListener('keydown', e => { if("wasd ".includes(e.key.toLowerCase())) keys[e.key.toLowerCase()] = true; if(e.key === ' ') interact(); });
    window.addEventListener('keyup', e => { if("wasd ".includes(e.key.toLowerCase())) keys[e.key.toLowerCase()] = false; });

    // –î–∂–æ–π—Å—Ç–∏–∫ Logic
    const joystick = document.getElementById('joystick');
    const stick = document.getElementById('stick');
    let touchId = null; 

    const handleJoy = (x, y) => {
        const rect = joystick.getBoundingClientRect();
        const cx = rect.left + rect.width/2;
        const cy = rect.top + rect.height/2;
        let dx = x - cx;
        let dy = y - cy;
        const dist = Math.min(Math.sqrt(dx*dx+dy*dy), rect.width/2);
        const angle = Math.atan2(dy, dx);
        
        const sx = Math.cos(angle) * dist;
        const sy = Math.sin(angle) * dist;
        
        stick.style.transform = `translate(calc(-50% + ${sx}px), calc(-50% + ${sy}px))`;
        joyInput.x = sx / (rect.width/2);
        joyInput.y = sy / (rect.height/2);
    };

    joystick.addEventListener('touchstart', e => { e.preventDefault(); touchId = e.changedTouches[0].identifier; handleJoy(e.changedTouches[0].clientX, e.changedTouches[0].clientY); });
    joystick.addEventListener('touchmove', e => { e.preventDefault(); for(let t of e.changedTouches) if(t.identifier === touchId) handleJoy(t.clientX, t.clientY); });
    const endJoy = () => { touchId = null; joyInput.x=0; joyInput.y=0; stick.style.transform = `translate(-50%, -50%)`; };
    joystick.addEventListener('touchend', endJoy);
    
    // –ö–Ω–æ–ø–∫–∞ –î—ñ—ó
    const btn = document.getElementById('action-btn');
    btn.addEventListener('touchstart', e => { e.preventDefault(); interact(); btn.style.transform="scale(0.9)"; });
    btn.addEventListener('touchend', e => { btn.style.transform="scale(1)"; });
    btn.addEventListener('mousedown', () => interact()); // –î–ª—è –ü–ö —Ç–µ—Å—Ç—ñ–≤ –º–∏—à–∫–æ—é

    // --- –õ–û–ì–Ü–ö–ê ---
    function showMsg(txt) {
        const el = document.getElementById('message');
        el.innerText = txt;
        el.style.display = 'block';
        setTimeout(() => el.style.display = 'none', 2000);
    }

    function interact() {
        if (player.isFishing) return;

        // –í—ñ–¥—Å—Ç–∞–Ω—å –¥–æ –æ–±'—î–∫—Ç—ñ–≤
        const dist = (x1, y1) => Math.hypot(player.x - x1, player.y - y1);
        const RANGE = 100;

        if (currentScene === 'shore') {
            // 1. –†–∏–±–æ–ª–æ–≤–ª—è
            if (player.x < waterZone.w + 50) {
                startFishing();
                return;
            }
            // 2. –ú–∞–≥–∞–∑–∏–Ω
            if (player.x > shopEntrance.x - 50) {
                currentScene = 'shop';
                player.x = canvas.width / 2;
                player.y = canvas.height - 120;
                showMsg("üè™ –ú–∞–≥–∞–∑–∏–Ω");
                return;
            }
            // 3. –î—ñ–º (–¶–µ–Ω—Ç—Ä)
            const dHome = dist(homeEntrance.x + homeEntrance.w/2, homeEntrance.y + homeEntrance.h);
            if (dHome < RANGE) {
                currentScene = 'home';
                player.x = canvas.width / 2;
                player.y = canvas.height - 120;
                showMsg("üè† –î—ñ–º");
                return;
            }
        }
        else if (currentScene === 'shop') {
            // –ü—Ä–æ–¥–∞–∂
            if (dist(shopCrates.x, shopCrates.y) < RANGE) {
                if (player.fish > 0) {
                    const gain = player.fish * 10;
                    player.money += gain;
                    player.fish = 0;
                    showMsg(`üí∞ –ü—Ä–æ–¥–∞–Ω–æ: +${gain}`);
                } else showMsg("‚ùå –ü—É—Å—Ç–æ");
                return;
            }
            // –ê–ø–≥—Ä–µ–π–¥
            if (dist(shopUpgrade.x, shopUpgrade.y) < RANGE) {
                if(player.rodLevel < upgrades.rod.level && player.money >= upgrades.rod.cost) {
                    player.money -= upgrades.rod.cost;
                    player.rodLevel = upgrades.rod.level;
                    showMsg("‚ú® –í—É–¥–∫–∞ PRO!");
                } else if(player.rodLevel >= upgrades.rod.level) showMsg("üîù –ú–∞–∫—Å–∏–º—É–º");
                else showMsg("‚ùå –ú–∞–ª–æ –≥—Ä–æ—à–µ–π");
                return;
            }
        }
        else if (currentScene === 'home') {
            // –°–æ–Ω
            if (dist(homeBed.x + homeBed.w/2, homeBed.y) < RANGE) {
                if (time.gameHour >= 20 || time.gameHour < 6) {
                    showMsg("üí§ –°–ø–∏–º–æ...");
                    setTimeout(() => {
                        time.gameHour = 6;
                        time.gameMinute = 0;
                        showMsg("‚òÄÔ∏è –†–∞–Ω–æ–∫!");
                    }, 1000);
                } else {
                    showMsg("‚ùå –©–µ —Ä–∞–Ω–æ —Å–ø–∞—Ç–∏");
                }
            }
        }
    }

    function startFishing() {
        player.isFishing = true;
        let delay = 3000;
        if (player.rodLevel > 1) delay = 1500;
        
        showMsg("üé£ –õ–æ–≤–∏–º–æ...");
        setTimeout(() => {
            player.fish++;
            player.isFishing = false;
            showMsg("‚úÖ +1 –†–∏–±–∞");
        }, delay);
    }

    function update(dt) {
        updateTime(dt);
        if (player.isFishing) return;

        // –†—É—Ö
        let dx = 0, dy = 0;
        if (keys.w) dy -= 1;
        if (keys.s) dy += 1;
        if (keys.a) dx -= 1;
        if (keys.d) dx += 1;
        
        dx += joyInput.x;
        dy += joyInput.y;

        player.x += dx * player.speed;
        player.y += dy * player.speed;

        // –û–±–º–µ–∂–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω—É
        player.x = Math.max(player.size/2, Math.min(canvas.width - player.size/2, player.x));
        player.y = Math.max(player.size/2, Math.min(canvas.height - player.size/2, player.y));

        // –ö–æ–ª—ñ–∑—ñ—ó –°–¶–ï–ù
        if (currentScene === 'shore') {
            // –ù–µ –∑–∞—Ö–æ–¥–∏—Ç–∏ —É –≤–æ–¥—É –≥–ª–∏–±–æ–∫–æ
            if (player.x < waterZone.w) player.x = waterZone.w;
            // –ù–µ –∑–∞—Ö–æ–¥–∏—Ç–∏ –≤ —Å—Ç—ñ–Ω—É –º–∞–≥–∞–∑–∏–Ω—É
            if (player.x > shopEntrance.x) player.x = shopEntrance.x;
            
            // –°—Ç—ñ–Ω–∏ –±—É–¥–∏–Ω–∫—É (–ø—Ä–æ—Å—Ç–∞ –∫–æ—Ä–æ–±–∫–∞)
            // –Ø–∫—â–æ –≥—Ä–∞–≤–µ—Ü—å –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –±—É–¥–∏–Ω–∫—É - –≤–∏—à—Ç–æ–≤—Ö—É—î–º–æ
            const hx = homeEntrance.x, hy = homeEntrance.y, hw = homeEntrance.w, hh = homeEntrance.h;
            // –Ø–∫—â–æ –≥—Ä–∞–≤–µ—Ü—å –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –ø—Ä–æ–π—Ç–∏ –∫—Ä—ñ–∑—å –¥—ñ–º (–Ω–µ –¥–≤–µ—Ä—ñ)
            // (–°–ø—Ä–æ—â–µ–Ω–∞ –∫–æ–ª—ñ–∑—ñ—è: –ø—Ä–æ—Å—Ç–æ –Ω–µ –ø—É—Å–∫–∞—î–º–æ –≤–≤–µ—Ä—Ö –≤–∏—â–µ –ø–æ—Ä–æ–≥–∞ –¥–æ–º—É, —è–∫—â–æ –ø–æ X –º–∏ –±—ñ–ª—è –¥–æ–º—É)
             if (player.x > hx && player.x < hx + hw && player.y < hy + hh) {
                 player.y = hy + hh;
             }
        }
        else if (currentScene === 'shop' || currentScene === 'home') {
            const exitY = (currentScene === 'shop' ? shopInterior.exitY : homeInterior.exitY);
            
            // –Ø–∫—â–æ –ø—ñ—à–ª–∏ –≤–Ω–∏–∑ - –≤–∏—Ö—ñ–¥
            if (player.y > exitY) {
                currentScene = 'shore';
                // –¢–µ–ª–µ–ø–æ—Ä—Ç –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É —Ç–æ—á–∫—É
                if(currentScene === 'shop') player.x = shopEntrance.x - 60; 
                else player.x = canvas.width/2;
                
                player.y = canvas.height/2 + 50; 
                showMsg("üå≥ –ë–µ—Ä–µ–≥");
            }
        }
        
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI
        document.getElementById('fish-count').innerText = player.fish;
        document.getElementById('money-count').innerText = player.money;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // --- –ú–ê–õ–Æ–í–ê–ù–ù–Ø –°–¶–ï–ù–ò ---
        if (currentScene === 'shore') {
            // –¢—Ä–∞–≤–∞
            ctx.fillStyle = '#66BB6A';
            ctx.fillRect(0,0,canvas.width, canvas.height);

            // –í–æ–¥–∞
            ctx.fillStyle = waterZone.color;
            ctx.fillRect(waterZone.x, waterZone.y, waterZone.w, waterZone.h);
            
            // –ú–∞–≥–∞–∑–∏–Ω
            ctx.fillStyle = shopEntrance.color;
            ctx.fillRect(shopEntrance.x, shopEntrance.y, shopEntrance.w, shopEntrance.h);
            ctx.fillStyle = 'white'; ctx.fillText('–ú–ê–ì–ê–ó–ò–ù', shopEntrance.x + 10, 100);

            // –î—ñ–º (–¶–ï–ù–¢–†)
            ctx.fillStyle = homeEntrance.color;
            ctx.fillRect(homeEntrance.x, homeEntrance.y, homeEntrance.w, homeEntrance.h);
            // –î–∞—Ö
            ctx.beginPath();
            ctx.moveTo(homeEntrance.x - 20, homeEntrance.y);
            ctx.lineTo(homeEntrance.x + homeEntrance.w/2, homeEntrance.y - 60);
            ctx.lineTo(homeEntrance.x + homeEntrance.w + 20, homeEntrance.y);
            ctx.fillStyle = '#5D4037'; ctx.fill();
            // –î–≤–µ—Ä—ñ
            ctx.fillStyle = '#3E2723';
            ctx.fillRect(homeEntrance.x + homeEntrance.w/2 - 25, homeEntrance.y + homeEntrance.h - 60, 50, 60);
            ctx.fillStyle = 'white'; ctx.fillText('–î–Ü–ú', homeEntrance.x + homeEntrance.w/2 - 15, homeEntrance.y + 50);

        } 
        else if (currentScene === 'shop') {
            ctx.fillStyle = shopInterior.color;
            ctx.fillRect(0,0,canvas.width, canvas.height);
            
            // –í–∏—Ö—ñ–¥
            ctx.fillStyle = '#rgba(255,255,255,0.1)';
            ctx.fillRect(0, shopInterior.exitY, canvas.width, 100);
            ctx.fillStyle = 'white'; ctx.fillText('–í–ò–•–Ü–î –í–ù–ò–ó', canvas.width/2 - 40, canvas.height - 30);

            // –û–±'—î–∫—Ç–∏
            ctx.fillStyle = shopCrates.color;
            ctx.fillRect(shopCrates.x - 40, shopCrates.y - 40, 80, 80);
            ctx.fillStyle = 'white'; ctx.fillText('–ü–†–û–î–ê–¢–ò', shopCrates.x - 30, shopCrates.y);

            ctx.fillStyle = shopUpgrade.color;
            ctx.fillRect(shopUpgrade.x - 40, shopUpgrade.y - 40, 80, 80);
            ctx.fillStyle = 'white'; ctx.fillText('–í–£–î–ö–ê', shopUpgrade.x - 20, shopUpgrade.y);
        } 
        else if (currentScene === 'home') {
            ctx.fillStyle = homeInterior.color;
            ctx.fillRect(0,0,canvas.width, canvas.height);

            // –õ—ñ–∂–∫–æ
            ctx.fillStyle = homeBed.color;
            ctx.fillRect(homeBed.x, homeBed.y, homeBed.w, homeBed.h);
            // –ü–æ–¥—É—à–∫–∞
            ctx.fillStyle = 'white'; 
            ctx.fillRect(homeBed.x + 10, homeBed.y + 10, homeBed.w - 20, 20);
            ctx.fillText('–õ–Ü–ñ–ö–û', homeBed.x + 30, homeBed.y + 50);

            // –í–∏—Ö—ñ–¥
            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(0, homeInterior.exitY, canvas.width, 100);
            ctx.fillStyle = 'white'; ctx.fillText('–í–ò–•–Ü–î –í–ù–ò–ó', canvas.width/2 - 40, canvas.height - 30);
        }

        // --- –ì–†–ê–í–ï–¶–¨ ---
        if (isImageLoaded) {
            ctx.drawImage(playerImage, player.x - player.size/2, player.y - player.size/2, player.size, player.size);
        } else {
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.size/2, 0, Math.PI*2);
            ctx.fillStyle = 'white'; ctx.fill(); ctx.stroke();
        }

        // --- –í–£–î–ö–ê ---
        if (player.isFishing && currentScene === 'shore') {
            ctx.beginPath();
            ctx.moveTo(player.x, player.y);
            ctx.lineTo(waterZone.w/2, player.y);
            ctx.strokeStyle = 'white'; ctx.lineWidth = 2; ctx.stroke();
            ctx.beginPath(); ctx.arc(waterZone.w/2, player.y, 5, 0, Math.PI*2); ctx.fillStyle='red'; ctx.fill();
        }

        // --- –ï–§–ï–ö–¢ –ù–û–ß–Ü ---
        ctx.fillStyle = getDayNightColor();
        ctx.fillRect(0,0,canvas.width, canvas.height);
        
        // --- –ü–Ü–î–ö–ê–ó–ö–ò ---
        ctx.font = "16px Montserrat";
        ctx.fillStyle = "white";
        // –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –ø—ñ–¥–∫–∞–∑–∫–∏ –±—ñ–ª—è –æ–±'—î–∫—Ç—ñ–≤ —Ç—É—Ç
    }

    function gameLoop(timeMs) {
        const dt = (timeMs - time.lastTime) / 1000;
        time.lastTime = timeMs;

        if (dt < 0.1) update(dt); // –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ —Å—Ç—Ä–∏–±–∫—ñ–≤ —á–∞—Å—É
        draw();
        requestAnimationFrame(gameLoop);
    }

    // –°—Ç–∞—Ä—Ç
    updateZoneDimensions();
    window.addEventListener('resize', updateZoneDimensions);
    function startGame() {
        time.lastTime = performance.now();
        requestAnimationFrame(gameLoop);
    }

    // –Ø–∫—â–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –≥—Ä—É–∑–∏—Ç—å—Å—è –¥–æ–≤–≥–æ - —Å—Ç–∞—Ä—Ç—É—î–º–æ –≤—Å–µ –æ–¥–Ω–æ
    setTimeout(() => { if(!isImageLoaded) startGame(); }, 1000);

</script>
</body>
</html>