<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2D –†–∏–±–∞–ª–∫–∞ –°–∏–º—É–ª—è—Ç–æ—Ä</title>
    <style>
        body {
            margin: 0;
            overflow: hidden; /* –ó–∞–±–æ—Ä–æ–Ω–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ */
            background-color: #333;
            font-family: Arial, sans-serif;
            touch-action: none; /* –í–∞–∂–ª–∏–≤–æ –¥–ª—è –¥–∂–æ–π—Å—Ç–∏–∫–∞ */
        }

        /* –Ü–≥—Ä–æ–≤–∏–π –µ–∫—Ä–∞–Ω */
        canvas {
            display: block;
            background-color: #4CAF50; /* –ö–æ–ª—ñ—Ä —Ç—Ä–∞–≤–∏ */
        }

        /* –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å (UI) */
        #ui-layer {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 1px 1px 2px black;
            pointer-events: none;
        }

        /* –ö–µ—Ä—É–≤–∞–Ω–Ω—è –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö */
        #mobile-controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            height: 150px;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            pointer-events: none; /* –©–æ–± –∫–ª—ñ–∫–∏ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –∫—Ä—ñ–∑—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        }

        /* –î–∂–æ–π—Å—Ç–∏–∫ (–ó–æ–Ω–∞) */
        .joystick-area {
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            position: relative;
            pointer-events: auto; /* –í–º–∏–∫–∞—î–º–æ –¥–æ—Ç–∏–∫ */
        }

        /* –°—Ç—ñ–∫ –¥–∂–æ–π—Å—Ç–∏–∫–∞ */
        .joystick-stick {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* –ö–Ω–æ–ø–∫–∞ –¥—ñ—ó */
        .action-btn {
            width: 100px;
            height: 100px;
            background: rgba(255, 0, 0, 0.5);
            border-radius: 50%;
            border: 2px solid white;
            color: white;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: auto; /* –í–º–∏–∫–∞—î–º–æ –¥–æ—Ç–∏–∫ */
            user-select: none;
        }

        .action-btn:active {
            background: rgba(255, 0, 0, 0.8);
        }

        /* –ü—ñ–¥–∫–∞–∑–∫–∏ */
        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: yellow;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px black;
            display: none;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div>üêü –†–∏–±–∞: <span id="fish-count">0</span></div>
        <div>üí∞ –ì—Ä–æ—à—ñ: <span id="money-count">0</span></div>
    </div>

    <div id="message"></div>

    <div id="mobile-controls">
        <div class="joystick-area" id="joystick">
            <div class="joystick-stick" id="stick"></div>
        </div>
        <div class="action-btn" id="action-btn">–î–Ü–Ø</div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    // --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ì–†–ò ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // –†–æ–∑–º—ñ—Ä–∏ –Ω–∞ –≤–µ—Å—å –µ–∫—Ä–∞–Ω
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // –°—Ç–∞–Ω –≥—Ä–∞–≤—Ü—è
    const player = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        size: 20,
        color: 'white',
        speed: 4,
        fish: 0,
        money: 0
    };

    // –ó–æ–Ω–∏ (–í–æ–¥–∞ —Ç–∞ –ú–∞–≥–∞–∑–∏–Ω)
    const waterZone = { x: 0, y: 0, w: 200, h: canvas.height, color: '#2196F3' }; // –õ—ñ–≤–æ—Ä—É—á
    const shopZone = { x: canvas.width - 200, y: 0, w: 200, h: canvas.height, color: '#795548' }; // –ü—Ä–∞–≤–æ—Ä—É—á

    // --- –ö–ï–†–£–í–ê–ù–ù–Ø ---
    const keys = { w: false, a: false, s: false, d: false };
    
    // –í–≤—ñ–¥ –∑ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏ (–ü–ö)
    window.addEventListener('keydown', (e) => {
        if(e.key === 'w' || e.key === 'W') keys.w = true;
        if(e.key === 'a' || e.key === 'A') keys.a = true;
        if(e.key === 's' || e.key === 'S') keys.s = true;
        if(e.key === 'd' || e.key === 'D') keys.d = true;
        if(e.key === ' ') handleAction(); // –ü—Ä–æ–±—ñ–ª
    });

    window.addEventListener('keyup', (e) => {
        if(e.key === 'w' || e.key === 'W') keys.w = false;
        if(e.key === 'a' || e.key === 'A') keys.a = false;
        if(e.key === 's' || e.key === 'S') keys.s = false;
        if(e.key === 'd' || e.key === 'D') keys.d = false;
    });

    // --- –î–ñ–û–ô–°–¢–ò–ö (–¢–ï–õ–ï–§–û–ù) ---
    const joystick = document.getElementById('joystick');
    const stick = document.getElementById('stick');
    let touchId = null;
    let joyInput = { x: 0, y: 0 }; // –í–µ–∫—Ç–æ—Ä —Ä—É—Ö—É (-1 –¥–æ 1)

    joystick.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const touch = e.changedTouches[0];
        touchId = touch.identifier;
        updateJoystick(touch);
    });

    joystick.addEventListener('touchmove', (e) => {
        e.preventDefault();
        for (let i = 0; i < e.changedTouches.length; i++) {
            if (e.changedTouches[i].identifier === touchId) {
                updateJoystick(e.changedTouches[i]);
                break;
            }
        }
    });

    joystick.addEventListener('touchend', (e) => {
        e.preventDefault();
        // –°–∫–∏–¥–∞–Ω–Ω—è –¥–∂–æ–π—Å—Ç–∏–∫–∞
        stick.style.transform = `translate(-50%, -50%)`;
        joyInput = { x: 0, y: 0 };
        touchId = null;
    });

    function updateJoystick(touch) {
        const rect = joystick.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;

        let dx = touch.clientX - centerX;
        let dy = touch.clientY - centerY;
        const distance = Math.min(Math.sqrt(dx*dx + dy*dy), rect.width/2);
        const angle = Math.atan2(dy, dx);

        const moveX = Math.cos(angle) * distance;
        const moveY = Math.sin(angle) * distance;

        stick.style.transform = `translate(calc(-50% + ${moveX}px), calc(-50% + ${moveY}px))`;

        // –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è (-1 –¥–æ 1)
        joyInput.x = moveX / (rect.width/2);
        joyInput.y = moveY / (rect.height/2);
    }

    // –ö–Ω–æ–ø–∫–∞ –î—ñ—ó (–¢–µ–ª–µ—Ñ–æ–Ω)
    document.getElementById('action-btn').addEventListener('touchstart', (e) => {
        e.preventDefault();
        handleAction();
        // –ï—Ñ–µ–∫—Ç –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è
        e.target.style.background = 'rgba(255, 255, 255, 0.3)';
        setTimeout(() => e.target.style.background = 'rgba(255, 0, 0, 0.5)', 100);
    });

    // --- –õ–û–ì–Ü–ö–ê –ì–†–ò ---
    
    function showMessage(text, duration = 1500) {
        const msg = document.getElementById('message');
        msg.innerText = text;
        msg.style.display = 'block';
        setTimeout(() => msg.style.display = 'none', duration);
    }

    function handleAction() {
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∏ –º–∏ —É –≤–æ–¥—ñ?
        if (player.x < waterZone.w) {
            catchFish();
        } 
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∏ –º–∏ –≤ –º–∞–≥–∞–∑–∏–Ω—ñ?
        else if (player.x > shopZone.x) {
            sellFish();
        } else {
            showMessage("–ü—ñ–¥—ñ–π–¥–∏ –¥–æ –≤–æ–¥–∏ –∞–±–æ –º–∞–≥–∞–∑–∏–Ω—É!");
        }
    }

    function catchFish() {
        showMessage("üé£ –õ–æ–≤–∏–º–æ —Ä–∏–±—É...");
        setTimeout(() => {
            player.fish++;
            document.getElementById('fish-count').innerText = player.fish;
            showMessage("‚úÖ –°–ø—ñ–π–º–∞–≤ —Ä–∏–±—É!");
        }, 1000); // –ß–∞—Å –ª–æ–≤–ª—ñ
    }

    function sellFish() {
        if (player.fish > 0) {
            let earnings = player.fish * 10;
            player.money += earnings;
            player.fish = 0;
            
            document.getElementById('fish-count').innerText = player.fish;
            document.getElementById('money-count').innerText = player.money;
            
            showMessage(`üí∞ –ü—Ä–æ–¥–∞–Ω–æ! +${earnings} –º–æ–Ω–µ—Ç`);
        } else {
            showMessage("‚ùå –ù–µ–º–∞—î —Ä–∏–±–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∂—É");
        }
    }

    function update() {
        // –†—É—Ö –ü–ö
        if (keys.w) player.y -= player.speed;
        if (keys.s) player.y += player.speed;
        if (keys.a) player.x -= player.speed;
        if (keys.d) player.x += player.speed;

        // –†—É—Ö –î–∂–æ–π—Å—Ç–∏–∫
        player.x += joyInput.x * player.speed;
        player.y += joyInput.y * player.speed;

        // –û–±–º–µ–∂–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω—É
        if (player.x < player.size) player.x = player.size;
        if (player.x > canvas.width - player.size) player.x = canvas.width - player.size;
        if (player.y < player.size) player.y = player.size;
        if (player.y > canvas.height - player.size) player.y = canvas.height - player.size;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. –ú–∞–ª—é—î–º–æ –í–æ–¥—É
        ctx.fillStyle = waterZone.color;
        ctx.fillRect(waterZone.x, waterZone.y, waterZone.w, waterZone.h);
        ctx.fillStyle = "white";
        ctx.font = "20px Arial";
        ctx.fillText("–í–û–î–ê", 20, canvas.height/2);

        // 2. –ú–∞–ª—é—î–º–æ –ú–∞–≥–∞–∑–∏–Ω
        ctx.fillStyle = shopZone.color;
        ctx.fillRect(shopZone.x, shopZone.y, shopZone.w, shopZone.h);
        ctx.fillStyle = "white";
        ctx.fillText("–ú–ê–ì–ê–ó–ò–ù", canvas.width - 150, canvas.height/2);

        // 3. –ú–∞–ª—é—î–º–æ –ì—Ä–∞–≤—Ü—è
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
        ctx.fillStyle = player.color;
        ctx.fill();
        ctx.strokeStyle = "black";
        ctx.stroke();

        // 4. –ü—ñ–¥–∫–∞–∑–∫–∞
        ctx.fillStyle = "black";
        ctx.font = "14px Arial";
        if (player.x < waterZone.w) {
            ctx.fillText("–¢–∏—Å–Ω–∏ –î–Ü–Æ —â–æ–± –ª–æ–≤–∏—Ç–∏", player.x + 25, player.y);
        } else if (player.x > shopZone.x) {
            ctx.fillText("–¢–∏—Å–Ω–∏ –î–Ü–Æ —â–æ–± –ø—Ä–æ–¥–∞—Ç–∏", player.x - 180, player.y);
        }
    }

    // –ì–æ–ª–æ–≤–Ω–∏–π —Ü–∏–∫–ª –≥—Ä–∏
    function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    // –†–µ—Å–∞–π–∑ –≤—ñ–∫–Ω–∞
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –º–∞–≥–∞–∑–∏–Ω—É –ø—Ä–∏ —Ä–µ—Å–∞–π–∑—ñ
        shopZone.x = canvas.width - 200;
        shopZone.h = canvas.height;
        waterZone.h = canvas.height;
    });

    // –°—Ç–∞—Ä—Ç
    gameLoop();

</script>
</body>
</html>