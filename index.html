<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2D –†–∏–±–∞–ª–∫–∞ –°–∏–º—É–ª—è—Ç–æ—Ä</title>
    <style>
        body {
            margin: 0;
            overflow: hidden; 
            background-color: #333;
            font-family: Arial, sans-serif;
            touch-action: none; 
        }

        canvas {
            display: block;
            background-color: #4CAF50; /* –¢—Ä–∞–≤–∞/–ë–µ—Ä–µ–≥ */
        }

        /* --- UI –®–∞—Ä–∏ --- */
        #ui-layer {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 1px 1px 2px black;
            pointer-events: none;
            z-index: 10;
        }

        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: yellow;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px black;
            display: none;
            pointer-events: none;
            z-index: 10;
        }

        /* --- –ö–µ—Ä—É–≤–∞–Ω–Ω—è --- */
        #mobile-controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            height: 150px;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            pointer-events: none;
            z-index: 10;
        }

        .joystick-area {
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            position: relative;
            pointer-events: auto; 
        }

        .joystick-stick {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .action-btn {
            width: 100px;
            height: 100px;
            background: rgba(255, 0, 0, 0.5);
            border-radius: 50%;
            border: 2px solid white;
            color: white;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: auto; 
            user-select: none;
        }

        .action-btn:active {
            background: rgba(255, 255, 255, 0.3);
        }

        /* --- –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–∞–≥–∞–∑–∏–Ω—É --- */
        #shop-ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            display: none; /* –ü—Ä–∏—Ö–æ–≤–∞–Ω–æ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
        }

        .shop-box {
            background: #795548;
            padding: 20px;
            margin: 10px;
            border: 3px solid #ccc;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div>üêü –†–∏–±–∞: <span id="fish-count">0</span></div>
        <div>üí∞ –ì—Ä–æ—à—ñ: <span id="money-count">0</span></div>
    </div>

    <div id="message"></div>

    <div id="shop-ui">
        <h2>–ü—Ä–æ–¥–∞—Ç–∏ –†–∏–±—É</h2>
        <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –î–Ü–Ø, —â–æ–± –ø—Ä–æ–¥–∞—Ç–∏ —É—Å—é —Ä–∏–±—É (10 –º–æ–Ω–µ—Ç –∑–∞ —à—Ç).</p>
        <div class="shop-box">
            <h3>üì¶ –Ø—â–∏–∫ –¥–ª—è –ø—Ä–æ–¥–∞–∂—É</h3>
            <p>–í–∞—à–∞ —Ä–∏–±–∞: <span id="shop-fish-count">0</span></p>
        </div>
        <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ESC –∞–±–æ –∫–Ω–æ–ø–∫—É –í–Ü–î–ú–Ü–ù–ê, —â–æ–± –≤–∏–π—Ç–∏.</p>
        <div class="action-btn" id="shop-exit-btn" style="background: #00bcd4; margin-top: 20px; pointer-events: auto;">–í–Ü–î–ú–Ü–ù–ê</div>
    </div>

    <div id="mobile-controls">
        <div class="joystick-area" id="joystick">
            <div class="joystick-stick" id="stick"></div>
        </div>
        <div class="action-btn" id="action-btn">–î–Ü–Ø</div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    // --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ì–†–ò ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–æ–∑–º—ñ—Ä—ñ–≤
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const player = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        size: 60, // –ó–±—ñ–ª—å—à–µ–Ω–∏–π —Ä–æ–∑–º—ñ—Ä
        speed: 4,
        fish: 0,
        money: 0,
        isFishing: false,
        isInShop: false // –ù–æ–≤–∏–π —Å—Ç–∞–Ω
    };

    // –†–æ–∑–º—ñ—Ä–∏ –∑–æ–Ω —É –≤—ñ–¥—Å–æ—Ç–∫–∞—Ö (–±—É–¥–µ –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤–∞–Ω–æ —É –ø—ñ–∫—Å–µ–ª—ñ)
    const ZONE_WIDTH_PERCENT = 0.20; 
    let zoneWidth = canvas.width * ZONE_WIDTH_PERCENT;

    // –ó–æ–Ω–∏ (–í–æ–¥–∞ —Ç–∞ –ú–∞–≥–∞–∑–∏–Ω)
    const waterZone = { x: 0, y: 0, w: zoneWidth, h: canvas.height, color: '#2196F3' }; 
    const shopZone = { x: canvas.width - zoneWidth, y: 0, w: zoneWidth, h: canvas.height, color: '#795548' }; 
    
    const FISHING_RANGE = player.size * 0.75; 

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    const playerImage = new Image();
    playerImage.src = 'Buzz_fisherman.png'; 
    let playerImageLoaded = false;
    let gameReady = false;

    playerImage.onload = () => {
        playerImageLoaded = true;
        gameReady = true;
        gameLoop(); 
    };

    playerImage.onerror = () => {
        console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è 'Buzz_fisherman.png'.");
        playerImageLoaded = false; 
        gameReady = true;
        gameLoop(); 
    };
    
    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—ñ–≤ –∑–æ–Ω –ø—Ä–∏ —Ä–µ—Å–∞–π–∑—ñ
    function updateZoneDimensions() {
        zoneWidth = canvas.width * ZONE_WIDTH_PERCENT;
        waterZone.w = zoneWidth;
        shopZone.x = canvas.width - zoneWidth;
        shopZone.w = zoneWidth;
        waterZone.h = canvas.height;
        shopZone.h = canvas.height;
    }

    // --- –ö–ï–†–£–í–ê–ù–ù–Ø ---
    const keys = { w: false, a: false, s: false, d: false };
    
    // –í—Ö—ñ–¥/–í–∏—Ö—ñ–¥ –∑ –º–∞–≥–∞–∑–∏–Ω—É –∫–ª–∞–≤—ñ—à–µ—é ESC
    window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' || e.key === 'Esc') {
            if (player.isInShop) exitShop();
        }
        if(e.key === 'w' || e.key === 'W') keys.w = true;
        if(e.key === 'a' || e.key === 'A') keys.a = true;
        if(e.key === 's' || e.key === 'S') keys.s = true;
        if(e.key === 'd' || e.key === 'D') keys.d = true;
        if(e.key === ' ') handleAction(); 
    });

    window.addEventListener('keyup', (e) => {
        if(e.key === 'w' || e.key === 'W') keys.w = false;
        if(e.key === 'a' || e.key === 'A') keys.a = false;
        if(e.key === 's' || e.key === 'S') keys.s = false;
        if(e.key === 'd' || e.key === 'D') keys.d = false;
    });

    // --- –î–ñ–û–ô–°–¢–ò–ö (—Å–∫–æ—Ä–æ—á–µ–Ω–æ, –ª–æ–≥—ñ–∫–∞ —Ç–∞—á/–º–∏—à–∞ –∑–∞–ª–∏—à–µ–Ω–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ—é) ---
    const joystick = document.getElementById('joystick');
    const stick = document.getElementById('stick');
    let touchId = null;
    let joyInput = { x: 0, y: 0 }; 
    let isDragging = false;

    // –°–∫–∏–¥–∞–Ω–Ω—è –¥–∂–æ–π—Å—Ç–∏–∫–∞
    function resetJoystick() {
        stick.style.transform = `translate(-50%, -50%)`;
        joyInput = { x: 0, y: 0 };
        isDragging = false;
        touchId = null;
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—ó –¥–∂–æ–π—Å—Ç–∏–∫–∞
    function updateJoystick(input) {
        const clientX = input.clientX || input.pageX;
        const clientY = input.clientY || input.pageY;
        const rect = joystick.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        let dx = clientX - centerX;
        let dy = clientY - centerY;
        const distance = Math.min(Math.sqrt(dx*dx + dy*dy), rect.width/2);
        const angle = Math.atan2(dy, dx);
        const moveX = Math.cos(angle) * distance;
        const moveY = Math.sin(angle) * distance;
        stick.style.transform = `translate(calc(-50% + ${moveX}px), calc(-50% + ${moveY}px))`;
        joyInput.x = moveX / (rect.width/2);
        joyInput.y = moveY / (rect.height/2);
    }
    
    // –û–±—Ä–æ–±–Ω–∏–∫–∏ (—Å–∫–æ—Ä–æ—á–µ–Ω–æ –¥–ª—è —è—Å–Ω–æ—Å—Ç—ñ, –∞–ª–µ –≤–∫–ª—é—á–∞—é—Ç—å –º–∏—à—É —Ç–∞ —Ç–∞—á)
    joystick.addEventListener('mousedown', (e) => { e.preventDefault(); isDragging = true; updateJoystick(e); });
    joystick.addEventListener('touchstart', (e) => { e.preventDefault(); const touch = e.changedTouches[0]; touchId = touch.identifier; isDragging = true; updateJoystick(touch); });
    window.addEventListener('mousemove', (e) => { if (isDragging && touchId === null) updateJoystick(e); });
    window.addEventListener('touchmove', (e) => { for (let i = 0; i < e.changedTouches.length; i++) { if (e.changedTouches[i].identifier === touchId) { updateJoystick(e.changedTouches[i]); break; } } });
    window.addEventListener('mouseup', (e) => { if (isDragging && touchId === null) resetJoystick(); });
    window.addEventListener('touchend', (e) => { for (let i = 0; i < e.changedTouches.length; i++) { if (e.changedTouches[i].identifier === touchId) { resetJoystick(); break; } } });

    // –ö–Ω–æ–ø–∫–∞ –î–Ü–Ø (–º–æ–±—ñ–ª—å–Ω–∞/–ü–ö)
    document.getElementById('action-btn').addEventListener('touchstart', (e) => { e.preventDefault(); handleAction(); });
    document.getElementById('action-btn').addEventListener('mousedown', (e) => { e.preventDefault(); handleAction(); });

    // –ö–Ω–æ–ø–∫–∞ –í–Ü–î–ú–Ü–ù–ê (–í–∏—Ö—ñ–¥ –∑ –º–∞–≥–∞–∑–∏–Ω—É)
    document.getElementById('shop-exit-btn').addEventListener('touchstart', (e) => { e.preventDefault(); exitShop(); });
    document.getElementById('shop-exit-btn').addEventListener('mousedown', (e) => { e.preventDefault(); exitShop(); });

    // --- –õ–û–ì–Ü–ö–ê –ì–†–ò ---
    
    function showMessage(text, duration = 1500) {
        const msg = document.getElementById('message');
        msg.innerText = text;
        msg.style.display = 'block';
        setTimeout(() => msg.style.display = 'none', duration);
    }

    function enterShop() {
        if (player.fish > 0) {
             document.getElementById('shop-fish-count').innerText = player.fish;
        } else {
             document.getElementById('shop-fish-count').innerText = 0;
        }

        player.isInShop = true;
        document.getElementById('shop-ui').style.display = 'flex';
        document.getElementById('mobile-controls').style.display = 'none';
        showMessage("–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –º–∞–≥–∞–∑–∏–Ω—É!", 1500);
    }

    function exitShop() {
        player.isInShop = false;
        document.getElementById('shop-ui').style.display = 'none';
        document.getElementById('mobile-controls').style.display = 'flex';
        showMessage("–í–∏ –≤–∏–π—à–ª–∏ –∑ –º–∞–≥–∞–∑–∏–Ω—É", 1500);
    }

    function handleAction() {
        if (player.isFishing) return; 

        if (player.isInShop) {
            sellFish();
            return;
        }

        const fishingSpotX = waterZone.w + player.size / 2; 
        const distanceToFishingSpot = Math.abs(player.x - fishingSpotX);

        const shopEntranceX = shopZone.x - player.size / 2;
        const distanceToShop = Math.abs(player.x - shopEntranceX);

        // 1. –†–∏–±–æ–ª–æ–≤–ª—è
        if (distanceToFishingSpot < FISHING_RANGE) {
            catchFish();
        } 
        // 2. –í—Ö—ñ–¥ –¥–æ –º–∞–≥–∞–∑–∏–Ω—É (–∫–æ–ª–∏ —Å—Ç–æ—ó—Ç—å –±—ñ–ª—è –≤—Ö–æ–¥—É)
        else if (distanceToShop < FISHING_RANGE) {
            enterShop();
        } 
        else {
            showMessage("–ü—ñ–¥—ñ–π–¥–∏ –¥–æ –≤–æ–¥–∏ –∞–±–æ –º–∞–≥–∞–∑–∏–Ω—É!");
        }
    }

    function catchFish() {
        player.isFishing = true; 
        showMessage("üé£ –í—É–¥–∫–∞ –∑–∞–∫–∏–Ω—É—Ç–∞...");

        setTimeout(() => {
            player.fish++;
            document.getElementById('fish-count').innerText = player.fish;
            showMessage("‚úÖ –°–ø—ñ–π–º–∞–≤ —Ä–∏–±—É!");
            player.isFishing = false; 
        }, 3000); 
    }

    function sellFish() {
        if (player.fish > 0) {
            let earnings = player.fish * 10;
            player.money += earnings;
            player.fish = 0;
            
            document.getElementById('fish-count').innerText = player.fish;
            document.getElementById('money-count').innerText = player.money;
            document.getElementById('shop-fish-count').innerText = 0;
            
            showMessage(`üí∞ –ü—Ä–æ–¥–∞–Ω–æ! +${earnings} –º–æ–Ω–µ—Ç`, 2500);
        } else {
            showMessage("‚ùå –ù–µ–º–∞—î —Ä–∏–±–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∂—É", 2500);
        }
    }

    function update() {
        if (player.isFishing || player.isInShop) return; 

        let dx = 0;
        let dy = 0;

        if (keys.w) dy -= player.speed;
        if (keys.s) dy += player.speed;
        if (keys.a) dx -= player.speed;
        if (keys.d) dx += player.speed;
        
        dx += joyInput.x * player.speed;
        dy += joyInput.y * player.speed;
        
        let newX = player.x + dx;
        let newY = player.y + dy;

        // –ë–õ–û–ö–£–í–ê–ù–ù–Ø –í–•–û–î–£ –£ –í–û–î–£ (–ª—ñ–≤–∏–π –∫—Ä–∞–π)
        if (newX - player.size / 2 < waterZone.w) {
            newX = waterZone.w + player.size / 2; 
        }
        
        // –û–±–º–µ–∂–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω—É
        if (newX < player.size / 2) newX = player.size / 2; 
        if (newX > canvas.width - player.size / 2) newX = canvas.width - player.size / 2;
        if (newY < player.size / 2) newY = player.size / 2;
        if (newY > canvas.height - player.size / 2) newY = canvas.height - player.size / 2;

        player.x = newX;
        player.y = newY;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. –ú–∞–ª—é—î–º–æ –í–æ–¥—É —Ç–∞ –ú–∞–≥–∞–∑–∏–Ω
        ctx.fillStyle = waterZone.color;
        ctx.fillRect(waterZone.x, waterZone.y, waterZone.w, waterZone.h);
        ctx.fillStyle = "white";
        ctx.font = "20px Arial";
        ctx.fillText("–í–û–î–ê", 20, canvas.height/2);

        ctx.fillStyle = shopZone.color;
        ctx.fillRect(shopZone.x, shopZone.y, shopZone.w, shopZone.h);
        ctx.fillStyle = "white";
        ctx.fillText("–ú–ê–ì–ê–ó–ò–ù", shopZone.x + 20, canvas.height/2);

        // 2. –ú–∞–ª—é—î–º–æ –ì—Ä–∞–≤—Ü—è (–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è)
        if (!player.isInShop) {
            if (playerImageLoaded) {
                ctx.drawImage(playerImage, player.x - player.size / 2, player.y - player.size / 2, player.size, player.size);
            } else {
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.size / 2, 0, Math.PI * 2);
                ctx.fillStyle = 'gray'; 
                ctx.fill();
                ctx.strokeStyle = "black";
                ctx.stroke();
            }
        }

        // 3. –ú–∞–ª—é—î–º–æ –≤—É–¥–∫—É
        if (player.isFishing) {
            ctx.beginPath();
            ctx.moveTo(player.x, player.y - player.size / 4); 
            ctx.lineTo(waterZone.w / 2, canvas.height / 2); 
            ctx.strokeStyle = "gray";
            ctx.lineWidth = 2;
            ctx.stroke();

            // –ü–æ–ø–ª–∞–≤–æ–∫
            ctx.beginPath();
            ctx.arc(waterZone.w / 2, canvas.height / 2, 5, 0, Math.PI * 2);
            ctx.fillStyle = "red";
            ctx.fill();
            ctx.strokeStyle = "black";
            ctx.lineWidth = 1;
            ctx.stroke();
        }

        // 4. –ü—ñ–¥–∫–∞–∑–∫–∏
        ctx.fillStyle = "black";
        ctx.font = "14px Arial";

        const fishingSpotX = waterZone.w + player.size / 2;
        const distanceToFishingSpot = Math.abs(player.x - fishingSpotX);

        const shopEntranceX = shopZone.x - player.size / 2;
        const distanceToShop = Math.abs(player.x - shopEntranceX);

        if (!player.isFishing && !player.isInShop) { 
            if (distanceToFishingSpot < FISHING_RANGE * 2) {
                ctx.fillText("–¢–∏—Å–Ω–∏ –î–Ü–Æ (–õ–æ–≤–∏—Ç–∏)", player.x + player.size / 2 + 5, player.y);
            } 
            else if (distanceToShop < FISHING_RANGE * 2) {
                ctx.fillText("–¢–∏—Å–Ω–∏ –î–Ü–Æ (–í—Ö—ñ–¥)", player.x - player.size / 2 - 80, player.y);
            }
        }
    }

    // –ì–æ–ª–æ–≤–Ω–∏–π —Ü–∏–∫–ª –≥—Ä–∏
    function gameLoop() {
        if (!gameReady) {
            requestAnimationFrame(gameLoop);
            return;
        }
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    // –†–µ—Å–∞–π–∑ –≤—ñ–∫–Ω–∞
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        updateZoneDimensions(); // –û–Ω–æ–≤–ª—é—î–º–æ —Ä–æ–∑–º—ñ—Ä–∏ –∑–æ–Ω
    });
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞ –∑–∞–ø—É—Å–∫
    updateZoneDimensions(); // –ü–µ—Ä—à–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ä–æ–∑–º—ñ—Ä—ñ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    if (playerImageLoaded) { 
        gameLoop();
    }
    // –Ü–Ω–∞–∫—à–µ –≥—Ä–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
</script>
</body>
</html>